<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Builder Pro — QRIS Style</title>
  <meta name="description" content="QR Builder Pro with QRIS-like styling presets, logo overlay, gradient, dotted, rounded modules, export PNG/SVG." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#061226; --card:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      --accent1:#0b72f6; --accent2:#0ea5c7; --muted:#9aa6b2;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#021024);color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:22px;border-radius:14px;background:var(--card)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:420px 1fr;gap:18px;margin-top:18px}
    .panel{padding:14px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
    input, textarea, select {width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    .row{display:flex;gap:8px}
    .btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#042028;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .field{margin-bottom:12px}
    #previewWrap{display:flex;align-items:center;justify-content:center;min-height:420px}
    #qrPreview{background:#fff;padding:18px;border-radius:12px;display:inline-block;cursor:zoom-in}
    .templates{display:flex;gap:8px;flex-wrap:wrap}
    .template{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);cursor:pointer;font-size:13px;color:var(--muted)}
    .dropzone{border:1px dashed rgba(255,255,255,0.06);padding:10px;border-radius:8px;text-align:center;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} #previewWrap{min-height:300px} }
    /* little badge under QR for QRIS style */
    .qris-badge{margin-top:10px;padding:4px 8px;border-radius:999px;background:linear-gradient(90deg,#e6f0ff,#dff7ff);color:#063;display:inline-block;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>QR Builder Pro — QRIS Style</h1>
        <div class="subtitle">Tambah style QRIS-like: warna, logo, border, gradient, dotted, rounded.</div>
      </div>
      <div class="small">Client-side • Offline-ready (except CDN)</div>
    </header>

    <div class="layout">
      <!-- controls -->
      <div class="panel" aria-label="controls">
        <div class="field">
          <label>Tipe QR</label>
          <select id="typeSelect">
            <option value="url">URL</option>
            <option value="text">Text</option>
            <option value="wifi">Wi-Fi</option>
            <option value="vcard">vCard</option>
            <option value="payment">Payment (demo)</option>
          </select>
        </div>

        <div id="blocks" class="field"></div>

        <div class="row field">
          <div style="flex:1">
            <label>Ukuran (px)</label>
            <input id="size" type="number" min="128" max="1024" value="360" />
          </div>
          <div style="width:140px">
            <label>EC</label>
            <select id="ecLevel"><option value="L">L</option><option value="M" selected>M</option><option value="Q">Q</option><option value="H">H</option></select>
          </div>
        </div>

        <div class="field">
          <label>Style Preset</label>
          <div class="templates">
            <div class="template" data-style="standard">Standard</div>
            <div class="template" data-style="qris">QRIS (Blue)</div>
            <div class="template" data-style="gradient">Gradient</div>
            <div class="template" data-style="dotted">Dotted</div>
            <div class="template" data-style="inverse">Inverted</div>
          </div>
        </div>

        <div class="row field">
          <div style="flex:1">
            <label>Foreground</label>
            <input id="fgColor" type="color" value="#0b72f6" />
          </div>
          <div style="width:120px">
            <label>Background</label>
            <input id="bgColor" type="color" value="#ffffff" />
          </div>
        </div>

        <div class="field">
          <label>Module shape</label>
          <select id="dotShape"><option value="rounded">Rounded</option><option value="dots">Dots</option><option value="square">Square</option></select>
        </div>

        <div class="field">
          <label>Corners style</label>
          <select id="cornerStyle"><option value="extra-rounded">Extra rounded</option><option value="square">Square</option><option value="dot">Dot</option></select>
        </div>

        <div class="field">
          <label>Logo (upload atau drop)</label>
          <div id="logoDrop" class="dropzone">Tarik & lepas file di sini atau klik untuk pilih</div>
          <div id="logoPreview" class="small">Belum ada logo</div>
          <div style="height:8px"></div>
          <label><input id="useQrisLogo" type="checkbox"> Gunakan logo QRIS default (demo)</label>
        </div>

        <div class="field controls">
          <button id="generateBtn" class="btn">Generate</button>
          <button id="downloadPngBtn" class="btn ghost">Download PNG</button>
          <button id="downloadSvgBtn" class="btn ghost">Download SVG</button>
          <button id="copyBtn" class="btn ghost">Copy Payload</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">

        <div class="field">
          <label>Presets cepat</label>
          <div class="templates" id="templateList">
            <div class="template" data-t="store">Store (QRIS Style)</div>
            <div class="template" data-t="profile">Social</div>
            <div class="template" data-t="wifi">Wi-Fi Guest</div>
            <div class="template" data-t="vcard">vCard</div>
          </div>
        </div>
      </div>

      <!-- preview -->
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Pratinjau</strong><div class="small">Klik QR untuk buka di tab baru</div></div>
          <div class="small">Client-side</div>
        </div>

        <div id="previewWrap" style="margin-top:12px">
          <div id="qrPreview" role="img" aria-label="QR preview"></div>
        </div>

        <div id="qrisBadgeWrap" style="text-align:center;margin-top:8px"></div>

        <div style="margin-top:12px">
          <label>Payload (yang akan di-encode)</label>
          <textarea id="payloadText" rows="5" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit"></textarea>
        </div>
      </div>
    </div>

    <footer>QR Builder Pro — QRIS-style features for demo only. Do not use for fraudulent transactions.</footer>
  </div>

  <!-- QR library -->
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
  <script>
  // --- Elements ---
  const blocks = document.getElementById('blocks');
  const typeSelect = document.getElementById('typeSelect');
  const payloadText = document.getElementById('payloadText');
  const sizeInput = document.getElementById('size');
  const previewWrap = document.getElementById('previewWrap');
  const qrRoot = document.getElementById('qrPreview');
  const qrisBadgeWrap = document.getElementById('qrisBadgeWrap');

  const fgColor = document.getElementById('fgColor');
  const bgColor = document.getElementById('bgColor');
  const ecLevel = document.getElementById('ecLevel');
  const dotShape = document.getElementById('dotShape');
  const cornerStyle = document.getElementById('cornerStyle');

  const logoDrop = document.getElementById('logoDrop');
  const logoPreview = document.getElementById('logoPreview');
  const useQrisLogo = document.getElementById('useQrisLogo');

  const generateBtn = document.getElementById('generateBtn');
  const downloadPngBtn = document.getElementById('downloadPngBtn');
  const downloadSvgBtn = document.getElementById('downloadSvgBtn');
  const copyBtn = document.getElementById('copyBtn');

  let qrCode = null;
  let logoDataUrl = null;

  // small embedded demo QRIS logo as SVG data URL (simple text badge) — safe for demo
  const QRIS_SVG = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect rx='24' ry='24' width='100%' height='100%' fill='#0b72f6' /><text x='50%' y='55%' font-size='60' font-family='Inter,Arial' fill='#fff' text-anchor='middle' dominant-baseline='middle'>QRIS</text></svg>`);
  const QRIS_DATAURL = 'data:image/svg+xml;charset=utf-8,' + QRIS_SVG;

  // helpers
  function makeBlock(html){ const d = document.createElement('div'); d.innerHTML = html; d.className='field'; return d; }
  function escapeSemicolon(s){ return s.replace(/;/g,'\\;'); }

  // dynamic input blocks
  function renderBlocksFor(type){
    blocks.innerHTML = '';
    if (type === 'url') blocks.appendChild(makeBlock('<label>URL</label><input id="urlInput" type="text" placeholder="https://example.com" />'));
    else if (type === 'text') blocks.appendChild(makeBlock('<label>Text</label><textarea id="textInput" rows="4" placeholder="Tulis teks..."></textarea>'));
    else if (type === 'wifi'){
      blocks.appendChild(makeBlock('<label>SSID</label><input id="wifi_ssid" type="text" placeholder="WiFi_SSID" />'));
      blocks.appendChild(makeBlock('<label>Password</label><input id="wifi_pass" type="text" placeholder="password" />'));
      blocks.appendChild(makeBlock('<label>Security</label><select id="wifi_sec"><option>WPA</option><option>WEP</option><option>nopass</option></select>'));
    } else if (type === 'vcard'){
      blocks.appendChild(makeBlock('<label>Nama</label><input id="vc_name" type="text" placeholder="Nama Lengkap" />'));
      blocks.appendChild(makeBlock('<label>Perusahaan</label><input id="vc_org" type="text" placeholder="Perusahaan" />'));
      blocks.appendChild(makeBlock('<label>Telepon</label><input id="vc_tel" type="text" placeholder="+62812..." />'));
      blocks.appendChild(makeBlock('<label>Email</label><input id="vc_email" type="text" placeholder="name@example.com" />'));
    } else if (type === 'payment'){
      blocks.appendChild(makeBlock('<label>Merchant ID</label><input id="pm_mid" type="text" placeholder="MERCHANT123" />'));
      blocks.appendChild(makeBlock('<label>Amount (opsional untuk static)</label><input id="pm_amount" type="text" placeholder="15000.00" />'));
      blocks.appendChild(makeBlock('<label>Reference</label><input id="pm_ref" type="text" placeholder="INV-001" />'));
    }
  }

  function buildPayload(){
    const t = typeSelect.value;
    if (t === 'url'){ const v = document.getElementById('urlInput')?.value || ''; payloadText.value = v; return v; }
    if (t === 'text'){ const v = document.getElementById('textInput')?.value || ''; payloadText.value = v; return v; }
    if (t === 'wifi'){
      const s = document.getElementById('wifi_ssid')?.value || '';
      const p = document.getElementById('wifi_pass')?.value || '';
      const sec = document.getElementById('wifi_sec')?.value || 'WPA';
      const val = `WIFI:T:${sec};S:${escapeSemicolon(s)};P:${escapeSemicolon(p)};;`;
      payloadText.value = val; return val;
    }
    if (t === 'vcard'){
      const n = document.getElementById('vc_name')?.value || '';
      const o = document.getElementById('vc_org')?.value || '';
      const tel = document.getElementById('vc_tel')?.value || '';
      const email = document.getElementById('vc_email')?.value || '';
      const val = `BEGIN:VCARD\nVERSION:3.0\nFN:${n}\nORG:${o}\nTEL:${tel}\nEMAIL:${email}\nEND:VCARD`;
      payloadText.value = val; return val;
    }
    if (t === 'payment'){
      const mid = document.getElementById('pm_mid')?.value || '';
      const amt = document.getElementById('pm_amount')?.value || '';
      const ref = document.getElementById('pm_ref')?.value || '';
      const val = `QRIS|MID:${mid}|AMT:${amt}|REF:${ref}`;
      payloadText.value = val; return val;
    }
    return '';
  }

  // map UI choices to qr-code-styling options
  function getQrOptions(data, size){
    const dotsType = dotShape.value === 'rounded' ? 'rounded' : (dotShape.value === 'dots' ? 'dots' : 'square');
    const cornersType = cornerStyle.value === 'extra-rounded' ? 'extra-rounded' : (cornerStyle.value === 'dot' ? 'dot' : 'square');

    const color = fgColor.value;
    const bg = bgColor.value;
    const useLogo = useQrisLogo.checked;

    return {
      width: size, height: size, data,
      dotsOptions: { color, type: dotsType },
      cornersSquareOptions: { type: cornersType },
      cornersDotOptions: { type: cornersType },
      backgroundOptions: { color: bg },
      imageOptions: { crossOrigin: 'anonymous', margin: 6, hideBackgroundDots: true },
      image: (useLogo && !logoDataUrl) ? QRIS_DATAURL : (logoDataUrl || undefined)
    };
  }

  // Apply style preset quick
  function applyPreset(name){
    if (name === 'standard'){
      fgColor.value = '#000000'; bgColor.value = '#ffffff'; dotShape.value='square'; cornerStyle.value='square'; useQrisLogo.checked = false; logoDataUrl = null; logoPreview.textContent = 'Belum ada logo';
    } else if (name === 'qris'){
      fgColor.value = '#0b72f6'; bgColor.value = '#ffffff'; dotShape.value='rounded'; cornerStyle.value='extra-rounded'; useQrisLogo.checked = true; logoPreview.textContent = 'QRIS demo logo aktif';
    } else if (name === 'gradient'){
      fgColor.value = '#7c3aed'; bgColor.value = '#ffffff'; dotShape.value='rounded'; cornerStyle.value='extra-rounded'; useQrisLogo.checked=false;
    } else if (name === 'dotted'){
      fgColor.value = '#0b72f6'; bgColor.value = '#ffffff'; dotShape.value='dots'; cornerStyle.value='dot'; useQrisLogo.checked=false;
    } else if (name === 'inverse'){
      fgColor.value = '#ffffff'; bgColor.value = '#0b1724'; dotShape.value='rounded'; cornerStyle.value='extra-rounded'; useQrisLogo.checked=false;
    }
  }

  // Create QR
  let lastOptions = null;
  async function createAndRender(){
    const data = buildPayload();
    if (!data) { alert('Isi data terlebih dahulu.'); return; }
    const size = parseInt(sizeInput.value,10) || 360;
    const opts = getQrOptions(data, size);
    lastOptions = {data, size, opts};
    // special: if preset gradient, create svg gradient overlay using extra option
    if (document.querySelector('.template[data-style="gradient"]')?.classList?.contains('active')) {
      // qr-code-styling doesn't support gradient dots directly; we simulate by rendering then overlaying gradient via svg manipulation — easier: set color to solid for now
    }
    // create
    if (qrCode){ try{ qrCode.clear(); }catch(e){} }
    qrCode = new QRCodeStyling(opts);
    qrRoot.innerHTML = '';
    qrCode.append(qrRoot);
    // QRIS badge under preview if qris preset
    const isQris = useQrisLogo.checked && (fgColor.value.toLowerCase()==='#0b72f6' || document.querySelector('.template[data-style="qris"]')?.classList?.contains('active'));
    qrisBadgeWrap.innerHTML = isQris ? `<div class="qris-badge">QRIS-style (demo)</div>` : '';
  }

  // initial blocks
  renderBlocksFor(typeSelect.value);
  typeSelect.addEventListener('change', ()=> renderBlocksFor(typeSelect.value));

  // generate button
  generateBtn.addEventListener('click', createAndRender);

  // templates (style presets)
  document.querySelectorAll('.template[data-style]').forEach(el=>{
    el.addEventListener('click', ()=>{
      document.querySelectorAll('.template[data-style]').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      applyPreset(el.dataset.style);
    });
  });

  // quick preset templates for content
  document.getElementById('templateList').addEventListener('click', (e)=>{
    const t = e.target.dataset.t; if(!t) return;
    if (t === 'store'){ typeSelect.value='payment'; renderBlocksFor('payment'); document.getElementById('pm_mid').value='MERCHANT-001'; document.getElementById('pm_amount').value=''; // apply qris style
      document.querySelector('.template[data-style="qris"]').click();
    }
    if (t === 'profile'){ typeSelect.value='url'; renderBlocksFor('url'); document.getElementById('urlInput').value='https://instagram.com/yourname'; }
    if (t === 'wifi'){ typeSelect.value='wifi'; renderBlocksFor('wifi'); document.getElementById('wifi_ssid').value='Guest_WiFi'; document.getElementById('wifi_pass').value='freewifi123'; }
    if (t === 'vcard'){ typeSelect.value='vcard'; renderBlocksFor('vcard'); document.getElementById('vc_name').value='Nama Anda'; document.getElementById('vc_tel').value='+6281...'; }
  });

  // logo drag-drop
  logoDrop.addEventListener('click', ()=> { const f = document.createElement('input'); f.type='file'; f.accept='image/*'; f.onchange=(e)=> handleLogoFile(e.target.files[0]); f.click(); });
  logoDrop.addEventListener('dragover', (e)=>{ e.preventDefault(); logoDrop.style.borderColor = fgColor.value; });
  logoDrop.addEventListener('dragleave', ()=>{ logoDrop.style.borderColor = ''; });
  logoDrop.addEventListener('drop', (e)=>{ e.preventDefault(); handleLogoFile(e.dataTransfer.files[0]); });

  function handleLogoFile(file){
    if (!file) return;
    if (!file.type.startsWith('image/')) return alert('Pilih file gambar (PNG/JPG/WebP)');
    const reader = new FileReader();
    reader.onload = ()=>{ logoDataUrl = reader.result; logoPreview.textContent = ''; const img = document.createElement('img'); img.src = logoDataUrl; img.style.width='64px'; img.style.height='64px'; img.style.objectFit='cover'; img.style.borderRadius='8px'; logoPreview.appendChild(img); };
    reader.readAsDataURL(file);
    useQrisLogo.checked = false;
  }

  // toggle use QRIS logo checkbox
  useQrisLogo.addEventListener('change', ()=> {
    if (useQrisLogo.checked) {
      logoDataUrl = null; logoPreview.textContent = 'QRIS demo logo aktif';
    } else {
      logoPreview.textContent = logoDataUrl ? '' : 'Belum ada logo';
      if (logoDataUrl && typeof logoPreview.appendChild === 'function') {
        // already previewed earlier
      }
    }
  });

  // download/export
  downloadPngBtn.addEventListener('click', async ()=>{
    if (!qrCode) return alert('Generate QR terlebih dahulu.');
    try{
      const blob = await qrCode.getRawData('png');
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'qrcode.png'; a.click(); URL.revokeObjectURL(url);
    }catch(e){ console.error(e); alert('Gagal download PNG'); }
  });

  downloadSvgBtn.addEventListener('click', async ()=>{
    if (!qrCode) return alert('Generate QR terlebih dahulu.');
    try{
      const svg = await qrCode.getRawData('svg');
      const blob = new Blob([svg], {type: 'image/svg+xml'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'qrcode.svg'; a.click(); URL.revokeObjectURL(url);
    }catch(e){ console.error(e); alert('Gagal download SVG'); }
  });

  copyBtn.addEventListener('click', async ()=>{ const txt = payloadText.value; if(!txt) return alert('Tidak ada payload'); try{ await navigator.clipboard.writeText(txt); alert('Payload disalin'); }catch(e){ alert('Gagal salin'); } });

  // click preview to open SVG in new tab
  qrRoot.addEventListener('click', async ()=>{
    if (!qrCode) return;
    try{
      const svg = await qrCode.getRawData('svg');
      const blob = new Blob([svg], {type:'image/svg+xml'});
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
    }catch(e){ console.error(e); }
  });

  // initial
  window.addEventListener('load', ()=>{ renderBlocksFor(typeSelect.value); document.querySelector('.template[data-style="qris"]').classList.add('active'); applyPreset('qris'); generateBtn.click(); });
  </script>
</body>
</html>
